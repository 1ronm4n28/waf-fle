mlog2waffle

mlog2waffle is a modsecurity log feeder to WAF-FLE (waf-fle.org), as a 
replacement for mlogc.

The mlog2waffle read event index file generated by modsecurity and send events to
WAF-FLE, in real time (using the "tail" mode) or periocally (in batch mode). You
don't need (actually you can't) to pipe modsecurity log to it, avoiding log
feeder to disturb web server.

mlog2waffle follow the same protocol used by mlogc (native log feeder from
modsecurity), but it was only tested with WAF-FLE.

FEATURES
--------

- Run in real time, following the "tail" of modsecurity index log
- Run in schedulled way in crontab
- Support send events with HTTPS (SSL/TLS)
- Multithread support to speed boost
- HTTP Keepalive to save resource and speed boost


REQUIREMENTS
------------
To run mlog2waffle in your server you need the follow components
 - Perl
 - libwww (6.0 or more recent for accept self-signed certificate)
 - File::Pid
 - File::Tail
 - LWP::UserAgent


INSTALLATION 
------------

Copy the config file to /etc/mlog2waffle.conf and edit it according to your needs,
it has many options documented in line.
For use it in real time mode, edit the config file to reflect this, like:
   $MODE = "tail";

and follow the steps described bellow.

- GENERIC
  Install perl packages needed by mlog2waffle, by using package management system
  from your SO or using CPAN.
  Use or adapt the init script in Ubuntu or RHEL version
  Copy mlog2waffle.conf to /etc/mlog2waffle.conf
  Edit /etc/mlog2waffle.conf to reflect your needs, the file has many comments
  to help you in ajust the parameters
  Start mlog2waffle as a service


- Ubuntu 
  apt-get install libfile-tail-perl libfile-pid-perl libwww-perl
  cp extra/mlog2waffle/mlog2waffle /usr/sbin/mlog2waffle
  cp extra/mlog2waffle/mlog2waffle.ubuntu /etc/init.d/mlog2waffle
  cp extra/mlog2waffle/mlog2waffle.conf /etc/mlog2waffle.conf
  # Edit /etc/mlog2waffle.conf to reflect your needs, the file has many comments
  # to help you in ajust the parameters
  update-rc.d mlog2waffle defaults 99
  service mlog2waffle start


- REDHAT (RHEL/CentOS/Scientific Linux)
  yum install perl-libwww-perl
  yum install perl-Time-HiRes
  install perl-File-Pid package (you can find the RPM on EPEL)
  install perl-File-Tail package (you can find the RPM on EPEL)
  cp extra/mlog2waffle/mlog2waffle /usr/sbin/mlog2waffle
  cp extra/mlog2waffle/mlog2waffle.rhel /etc/init.d/mlog2waffle
  cp extra/mlog2waffle/mlog2waffle.conf /etc/mlog2waffle.conf
  # Edit /etc/mlog2waffle.conf to reflect your needs, the file has many comments
  # to help you in ajust the parameters
  chkconfig --add mlog2waffle
  service mlog2waffle start
  

To run it on batch mode, follow the steps above but don't make the service
startable, instead edit the config file like this:
  $MODE = "batch";

Create a crontab entry to run it in a timelly fashion, like
this:
  */5 * * * /usr/sbin/mlog2waffle
